---
name: configure-kubecf

description: Uses the cf CLI to configure the KUBECF under test once it's online (things like proxy settings, service brokers, etc.)

packages:
  - cli
  - ruby-2.3
  - service-registration-utils
  - kubectl

templates:
  run.erb: bin/run
  eirini-daemonset.yaml.erb: config/eirini-daemonset.yaml

properties:
  cf.insecure_api_url:
    description: The Cloud Controllers's API endpoint (without TLS)
  kubecf_set_proxy.staging_http_proxy:
    description: The HTTP proxy to use during staging
  kubecf_set_proxy.staging_https_proxy:
    description: The HTTPS proxy to use during staging
  kubecf_set_proxy.staging_no_proxy:
    description: The NO_PROXY setting to use during staging
  kubecf_set_proxy.running_http_proxy:
    description: The HTTP proxy to use during running
  kubecf_set_proxy.running_https_proxy:
    description: The HTTPS proxy to use during running
  kubecf_set_proxy.running_no_proxy:
    description: The NO_PROXY setting to use during running
  kubecf.uaa.internal-url:
    description: URL to UAA that can be accessed before the cluster's domain is setup
  ssl.skip_cert_verify:
    description: True for insecure connections
  uaa.clients.kubecf_auto_config.secret:
    description: The secret for the UAA client to set up proxies
  cf_mysql.external_host:
    description: 'Host address of the service broker'
  cf_mysql.broker.protocol:
    description: 'Protocol (http/https) provided to the Cloud Controller when registering/de-registering the broker'
    default: https
  cf_mysql.broker.port:
    description: 'Port for the service broker'
    default: 443
  cf_mysql.broker.auth_username:
    description: 'Basic Auth username for the service broker'
    default: admin
  cf_mysql.broker.auth_password:
    description: 'Basic Auth password for the service broker'
  cf_mysql.mysql.port:
    description: 'Port used by the service broker and bound applications to reach the service'
    default: 3306
  nfsbroker.url:
    description: 'Internal URL of the Persi NFS broker'
  nfsbroker.username:
    description: "basic auth username to verify on incoming Service Broker requests"
    default: "admin"
  nfsbroker.password:
    description: "basic auth password to verify on incoming Service Broker requests"
  kubecf.secrets_generation_name:
    description: "Name of the Kubernetes secret containing all KUBECF's certificates, passwords and keys"
  kubecf.eirini.namespace:
    description: "Name of the namespace where Eirini runs Cloud Foundry applications"
  kubecf.eirini.fluentd_image:
    description: "The docker image used by Eirini to consume Kubernetes container logs"
  kubecf.eirini.cert_copier_image:
    description: "The docker image used by Eirini to register the image registry CA cert with Docker, on each Kubernetes node"
  kubecf.eirini.doppler_address:
    description: "KUBECF's doppler address, used to stream application logs"
  kubecf.eirini.doppler_address_with_az:
    description: "KUBECF's doppler address for the current AZ, used to stream application logs"
  kubecf.eirini.registry.address:
    description: "Eirini's image registry public address"
  kubecf.eirini.enabled:
    description: "Whether Eirini is enabled or not"
